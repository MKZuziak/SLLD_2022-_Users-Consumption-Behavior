# [Statistical Learning and Large Data - Web Application Consumption]{.smallcaps}

---
title: "Statistical Learning and Large Data - Web Application Consumption"
auhor: "Maciej Zuziak & Roberto Casaluce"
date: "14/04/2022"
output:
  pdf_document:
    toc: true
  html_document: default
urlcolor: blue
editor_options: 
  markdown: 
    wrap: 72
---

```{r}
library(mvtnorm)
library(factoextra)
library(scales)
library(ellipse)
library(corrplot)
library(ggplot2)
library(dplyr)
```

## [Data Exploration & Preparation]{.smallcaps}

```{r}
head(Users.Consumption.Behavior._2019)
```

```{r}
data <- Users.Consumption.Behavior._2019
head(data)
data[,114]
```

```{r}
# Adding a column based on other column:
data <- data%>% mutate(Target = case_when(cluster == "0" ~ "Low",
    cluster == "1" ~ "Medium",
    cluster==  "2" ~ "High"
  ))
```

```{r}
sum(is.na(data))
sum(is.null(data))
```

```{r}
dict <- sapply(data, n_distinct)
print(class(dict))
dict
```

```{r}
# Detaching column containing clusters (column no. 114)
Users_data_overview <- data[,1:113]
data_copy <- Users_data_overview
data_copy
```

Because it was observed, that some categories contain abundance of
values equal 0 (no app consumption) registered for that user, we have
decided to investigate this matter closer.

```{r}
column_names <- c(names(data_copy))
column_names = column_names[2:113]
columns_overview = data.frame(df=column_names)

missing_values = c()
for(i in 2:ncol(Users_data_overview)){
  # Null_values(0)
  sums_zero = sum(data_copy[, i] == 0)
  missing_val = sums_zero
  missing_values = append(missing_values, missing_val)
}

columns_overview$null_values <- c(missing_values)
sorted_overview <-columns_overview[order(columns_overview$null_values, decreasing=FALSE),]
sorted_overview

hist(sorted_overview$null_values,
     main = "Histogram for missing values",
     xlab = "No. of missing values",
     border = "blue",
     col = "green")
```

The histogram presented above clearly indicates that there is a problem
with some categories included in the dataset. Around 30% of the features
does not contain values from around 1200 to 1400 users. Another 30% of
features does not contain values from around 800 1200 users. From that
point onward, there are two possible solutions for that problem:

-   We could remove 60% of the features that are above some
    missing-value threshold.

-   We could perform a PCA on the whole dataset, thus eliminating
    unnecessary features that do not contain much information about
    users behavior.

For now I would prefer the first option - but its open to debate what
behavior we may adapt.

```{r}
uniquelength <- sapply(data,function(x) length(unique(x)))
data <- subset(data, select=uniquelength>2)
data
```

```{r}
uniquelength <- sapply(data,function(x) length(unique(x)))
data <- subset(data, select=uniquelength>2)
data
dict <- sapply(data, n_distinct)
print(class(dict))
dict[0:106]
hist(dict[0:106],
     main = "Histogram for missing values",
     xlab = "No. of missing values",
     border = "blue",
     col = "green")
```

```{r}
colClean <- function(x){ colnames(x) <- gsub("_occupation", "", colnames(x)); x }
data <- colClean(data)
data
```
```{r}
#correlation for just a few features
library(corrplot)
M<-cor(data[,2:5])
head(round(M,2))
#first type of correlation plot
corrplot(M, method="circle")
#second type of correlation plot
corrplot(M, method="number")

###Removing highly correlated variables
###Removing highly correlated variable#### It needs to be tested
cor_matrix <- cor(data[,1:107])  # Correlation matrix
cor_matrix
```
```{r}
# Using the sample mean as a 0-dimensional reduction of data on the example of 'HTTP_time' and 'Amazon_time'
exemplary_entry = data[, c('HTTP_time', 'Amazon_time')]
med <- colMeans(exemplary_entry) #PC 0

#plotting the mean
plot(exemplary_entry, asp=1)
points(med[1], med[2], col='red', pch=16)

plot(exemplary_entry, asp=1)
points(med[1], med[2], col='red', pch=16)
for(i in 1:200)
  lines(rbind(exemplary_entry[i,], med), col='red')
```

```{r}

```


\`\`\`
